<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Anggota â€“ Export JSON & WhatsApp</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f0f0; padding:20px; }
    .btn { padding:8px 14px; border:none; border-radius:4px; cursor:pointer; margin:4px; }
    .btn-info { background:#2196F3; color:#fff; }
    .btn-warning { background:#f0ad4e; color:#fff; }

    .modal {
      display: flex;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.57);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #bdbdbdb8;
      padding: 33px;
      border-radius: 21px;
      width: 93%;
      max-width: 759px;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }
    .close { position:absolute; right:15px; top:10px; font-size:28px; cursor:pointer; }
    .form-group { margin-bottom:15px; }
    .form-row { display:flex; gap:15px; flex-wrap:wrap; }
    label { display:block; margin-bottom:5px; font-weight:bold; }
    input, textarea, select {
      width:100%; padding:8px; border:1px solid #ccc; border-radius:4px;
      box-sizing:border-box;
    }
    textarea { resize:vertical; }
    .photo-upload-container {
      border:2px dashed #ccc; border-radius:8px; padding:10px;
      text-align:center; background:#fafafa; cursor:pointer;
    }
    .photo-preview {
      max-width:150px; max-height:150px; display:block; margin:10px auto;
      object-fit:cover; border-radius:8px;
    }
    small { font-size:12px; color:#666; }
  </style>
</head>
<body>

  <!-- Modal langsung ditampilkan -->
  <div id="memberModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeMemberModal()">&times;</span>
      <h2 id="memberModalTitle">Data Anggota</h2>

      <form id="memberForm">
        <input type="hidden" id="memberId">

        <div class="form-group">
          <label>Foto Profil</label>
          <div class="photo-upload-container">
            <img id="photoPreview" class="photo-preview" alt="Preview">
            <div id="uploadPrompt">
              <p>ðŸ“¸ Klik untuk upload foto atau drag & drop</p>
              <button type="button" class="btn btn-info" onclick="document.getElementById('memberPhoto').click()">Pilih Foto</button>
            </div>
            <input type="file" id="memberPhoto" accept="image/*" style="display:none;">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group" style="flex:1">
            <label>NAT (Nomor Anggota)</label>
            <input type="text" id="memberNAT" placeholder="002/TSCA-MKS/90" required>
          </div>
          <div class="form-group" style="flex:1">
            <label>Nama Lengkap</label>
            <input type="text" id="memberName" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group" style="flex:1">
            <label>Tempat Lahir</label>
            <input type="text" id="memberBirthPlace" placeholder="Contoh: Makassar">
          </div>
          <div class="form-group" style="flex:1">
            <label>Tanggal Lahir</label>
            <input type="date" id="memberBirthDate">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group" style="flex:1">
            <label>Email</label>
            <input type="email" id="memberEmail" required>
          </div>
          <div class="form-group" style="flex:1">
            <label>Nomor Telepon</label>
            <input type="tel" id="memberPhone" required>
          </div>
        </div>

        <div class="form-group">
          <label>Golongan Darah</label>
          <select id="memberBlood" required>
            <option value="">-- Pilih Golongan Darah --</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="AB">AB</option>
            <option value="O">O</option>
          </select>
        </div>

        <div class="form-group">
          <label>Alamat</label>
          <textarea id="memberAddress" rows="2"></textarea>
        </div>

        <div class="form-group">
          <label>Angkatan</label>
          <input type="text" id="memberJoinDate" placeholder="Contoh: Angkatan XII / 2025">
        </div>

        <!-- Tombol Export JSON & WhatsApp -->
        <div class="form-group">
          <label>Nomor WhatsApp Tujuan</label>
          <input type="tel" id="targetWhatsApp" placeholder="Contoh: 6281234567890" value="6281234567890">
          <small style="display:block; margin-top:5px;">Format: 62 + nomor (tanpa 0 di awal)</small>
        </div>

        <div style="margin-top:20px;">
          <button type="submit" class="btn btn-info">ðŸ’¾ Export JSON</button>
          <button type="button" class="btn btn-info" onclick="sendToWhatsApp()">ðŸ“± Kirim ke WhatsApp</button>
          <button type="button" class="btn btn-warning" onclick="closeMemberModal()">Batal</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const modal = document.getElementById('memberModal');
    const form  = document.getElementById('memberForm');
    const photoInput = document.getElementById('memberPhoto');
    const photoPreview = document.getElementById('photoPreview');

    const memberData = []; // array data

    function closeMemberModal() {
      modal.style.display = 'none';
      form.reset();
      photoPreview.src = '';
    }

    photoInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) photoPreview.src = URL.createObjectURL(file);
    });

    // Submit -> simpan data & langsung export JSON
    form.addEventListener('submit', e => {
      e.preventDefault();
      saveMemberData();
      exportMemberData();
    });

    function saveMemberData() {
      const data = {
        id: Date.now(),
        nat: document.getElementById('memberNAT').value,
        name: document.getElementById('memberName').value,
        birthPlace: document.getElementById('memberBirthPlace').value,
        birthDate: document.getElementById('memberBirthDate').value,
        email: document.getElementById('memberEmail').value,
        phone: document.getElementById('memberPhone').value,
        blood: document.getElementById('memberBlood').value,
        address: document.getElementById('memberAddress').value,
        joinDate: document.getElementById('memberJoinDate').value
      };
      memberData.push(data);
      return data;
    }

    function exportMemberData() {
      const jsonStr = JSON.stringify(memberData, null, 2);
      const blob = new Blob([jsonStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'anggota.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('File JSON berhasil didownload!');
    }

    function sendToWhatsApp() {
      // Validasi form terlebih dahulu
      if (!form.checkValidity()) {
        alert('Mohon lengkapi semua field yang wajib diisi!');
        form.reportValidity();
        return;
      }

      // Simpan data jika belum
      const data = saveMemberData();

      // Ambil nomor WhatsApp tujuan
      const waNumber = document.getElementById('targetWhatsApp').value.replace(/[^0-9]/g, '');
      
      if (!waNumber) {
        alert('Mohon masukkan nomor WhatsApp tujuan!');
        return;
      }

      // Format data menjadi teks untuk WhatsApp
      const message = `ðŸ“‹ *DATA ANGGOTA BARU*\n\n` +
        `NAT: ${data.nat}\n` +
        `Nama: ${data.name}\n` +
        `Tempat, Tgl Lahir: ${data.birthPlace}, ${data.birthDate}\n` +
        `Email: ${data.email}\n` +
        `Telepon: ${data.phone}\n` +
        `Golongan Darah: ${data.blood}\n` +
        `Alamat: ${data.address}\n` +
        `Angkatan: ${data.joinDate}\n\n` +
        `_Data JSON lengkap:_\n\`\`\`${JSON.stringify(data, null, 2)}\`\`\``;

      // Encode pesan untuk URL
      const encodedMessage = encodeURIComponent(message);

      // Buka WhatsApp dengan pesan
      const waUrl = `https://wa.me/${waNumber}?text=${encodedMessage}`;
      window.open(waUrl, '_blank');

      alert('Data berhasil dikirim ke WhatsApp! Silakan kirim pesan dari aplikasi WhatsApp yang terbuka.');
    }
  </script>
</body>
</html>
